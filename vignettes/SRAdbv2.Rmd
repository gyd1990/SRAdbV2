---
title: "Using the SRAdbV2 Package"
author: "Sean Davis"
#package: SRAdbV2
output: BiocStyle::html_document
vignette: |
  %\VignetteIndexEntry{Using the SRAdbV2 Package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}  
---

# Installation

```{r eval=FALSE}
source('https://bioconductor.org/biocLite.R')
biocLite('seandavi/SRAdbV2')
```

# Setup

```{r}
library(SRAdbV2)
```

# Using the  NEW interface

```{r}
oidx = Omicidx$new()
query=paste(
  paste0('sample_taxon_id:', 10116),
  'AND experiment_library_strategy:"rna seq"',
  'AND experiment_library_source:transcriptomic',
  'AND experiment_platform:illumina')
z = oidx$search(q=query,entity='full',size=500L)
s = z$scroll()
# for VERY large result sets, this may take
# quite a bit of time and/or memory. An
# alternative is to use s$chunk() to retrieve
# one batch of records at a time and process
# incrementally.
res = s$collate()
head(res)
```


# The OLD interface

The search capabilities below all return `tibble`s. The approach for getting large
result sets is to loop over results in blocks of size `size`. The result of a 
search contains an attribute, `count`, that gives the total number of records. 

```{r}
res = sra_experiment_search()
# total results
attr(res,'count')
```

Using `dplyr::bind_rows()` is the recommended approach for binding individual
calls to the search. *The requirement to manually loop over results will likely
be replaced by built-in functionality.*


```{r}
sra_run_search()
sra_full_search()
sra_study_search(q='cancer')
```

# Using the raw API without R/Bioconductor

The SRAdbV2 is a client to a high-performance web-based API. As
such, the web API is perfectly usable from either a simple test page, 
accessible here:

```{r eval=FALSE}
sra_browse_API()
```

![](images/API.png)


The API is described using the OpenAPI standard, also known as 
[Swagger](https://swagger.io/). Tooling exists to quickly scaffold
clients in any language (basically) based on the json available here:

```{r}
sra_get_swagger_json_url()
```

